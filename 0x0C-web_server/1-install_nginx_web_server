#!/usr/bin/env bash
# Bash script to install and configure Nginx web server

# Update package list and install nginx
apt-get update
apt-get install -y nginx

# Check if nginx is successfully installed
if [ ! -x /usr/sbin/nginx ]; then
  echo "Error: Nginx installation failed."
  exit 1
fi

# Create index.html with "Hello World!"
echo "Hello World!" > /var/www/html/index.html

# Restart nginx without using systemctl
service nginx restart > /dev/null 2>&1 || /etc/init.d/nginx restart > /dev/null 2>&1

# Check if nginx is running
if ! pgrep nginx > /dev/null 2>&1; then
  echo "Error: Nginx failed to start."
  exit 1
fi

# Verify nginx is listening on port 80
if ! netstat -tnl | grep -q ':80 '; then
  echo "Error: Nginx is not listening on port 80."
  exit 1
fi

# Verify the server returns a 200 status code when querying the root URL
if ! curl -s -o /dev/null -w "%{http_code}" http://localhost | grep -q "200"; then
  echo "Error: Nginx did not return a 200 status code."
  exit 1
fi

# Verify the server returns the correct content
if ! curl -s http://localhost | grep -q "Hello World!"; then
  echo "Error: Nginx did not return the expected content."
  exit 1
fi

echo "Nginx installed and configured successfully!"

